# RADS v0.0.3 "Butterfly" - Focused Release Plan

**Codename:** Butterfly ğŸ¦‹
**Status:** âœ… AUTHORIZED FOR DEVELOPMENT
**Target:** 1-2 weeks sprint
**Focus:** Database connectivity, testing, and developer experience

---

## ğŸ¯ Core Philosophy

**v0.0.3 Butterfly** represents metamorphosis - transforming RADS from a prototype language into a production-ready platform for building real applications.

Like a butterfly emerging from its chrysalis, RADS will gain:
- **Wings to fly** (database connectivity)
- **Colors to shine** (testing framework)
- **Strength to soar** (improved async)

---

## âœ¨ The Big 3 Features

### 1. ğŸ’¾ SQLite Database Driver
**Priority:** HIGHEST
**Timeline:** 2-3 days
**Impact:** Enables real applications

**What:**
- Full SQLite3 integration via C library
- Simple, elegant API
- Connection management
- Prepared statements
- Transaction support

**API Design:**
```rads
// Connect to database
turbo db = db.open("app.db");

// Execute query
turbo rows = db.query("SELECT * FROM users WHERE age > ?", [18]);

// Iterate results
cruise row in rows {
    echo("User: " + row.name);
}

// Insert data
db.execute("INSERT INTO users (name, age) VALUES (?, ?)", ["Alice", 25]);

// Transactions
db.begin();
db.execute("UPDATE users SET balance = balance - 100 WHERE id = 1");
db.execute("UPDATE users SET balance = balance + 100 WHERE id = 2");
db.commit();

// Close connection
db.close();
```

**Files to Create:**
- `src/stdlib/stdlib_db.c` - SQLite bindings
- `examples/database_demo.rads` - Example usage
- `docs/DATABASE.md` - Documentation

**Implementation Steps:**
1. Add SQLite3 library to Makefile (`-lsqlite3`)
2. Create `db.open()` function
3. Create `db.query()` with result set handling
4. Add `db.execute()` for INSERT/UPDATE/DELETE
5. Add `db.begin()`, `db.commit()`, `db.rollback()`
6. Add prepared statement parameter binding
7. Create error handling for SQL errors
8. Write comprehensive examples

---

### 2. ğŸ§ª Built-in Testing Framework
**Priority:** HIGH
**Timeline:** 3-4 days
**Impact:** Code quality and confidence

**What:**
- `test` keyword for defining tests
- Built-in assertions
- Test runner (`rads test <file>`)
- Colored pass/fail output
- Test statistics

**API Design:**
```rads
// Define tests with test keyword
test "addition works" {
    turbo result = 2 + 2;
    assert_eq(result, 4);
}

test "string concatenation" {
    turbo msg = "Hello" + " " + "World";
    assert_eq(msg, "Hello World");
}

test "array methods" {
    turbo arr = [1, 2, 3];
    arr.push(4);
    assert_eq(arr.length, 4);
}

// Test with setup/teardown
test "database operations" {
    turbo db = db.open(":memory:");
    db.execute("CREATE TABLE users (id INTEGER, name TEXT)");
    db.execute("INSERT INTO users VALUES (1, 'Alice')");

    turbo rows = db.query("SELECT * FROM users");
    assert_eq(rows.length, 1);

    db.close();
}
```

**Assertion Functions:**
```rads
assert(condition)                    // Basic assertion
assert_eq(actual, expected)          // Equality
assert_neq(actual, not_expected)     // Inequality
assert_true(value)                   // True check
assert_false(value)                  // False check
assert_null(value)                   // Null check
assert_not_null(value)               // Not null check
```

**Test Runner Output:**
```
ğŸ§ª Running tests from test_app.rads

âœ… addition works (0.1ms)
âœ… string concatenation (0.2ms)
âœ… array methods (0.3ms)
âœ… database operations (2.1ms)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Results: 4 passed, 0 failed, 4 total
Time: 2.7ms
ğŸš€ All tests passed!
```

**Files to Create:**
- `src/core/lexer.c` - Add `TEST` token
- `src/core/parser.c` - Parse test blocks
- `src/core/interpreter.c` - Test execution
- `src/stdlib/stdlib_test.c` - Assertion functions
- `tools/rads-test/test_runner.c` - CLI test runner
- `tests/test_example.rads` - Example tests

---

### 3. âš¡ Enhanced Async with Promise.all()
**Priority:** MEDIUM
**Timeline:** 1-2 days
**Impact:** Parallel async operations

**What:**
- `Promise.all()` for parallel execution
- Better error handling in async contexts
- Timeout support with `Promise.race()`

**API Design:**
```rads
// Parallel HTTP requests
turbo promises = [
    http.get("/api/users/1"),
    http.get("/api/users/2"),
    http.get("/api/users/3")
];

turbo results = await Promise.all(promises);
echo("Got " + results.length + " results");

// Race with timeout
turbo result = await Promise.race([
    http.get("/api/slow"),
    Promise.timeout(5000)  // 5 second timeout
]);

// Error handling
try {
    turbo data = await Promise.all([
        fetch_user(1),
        fetch_user(2)
    ]);
} catch (error) {
    echo("Error: " + error.message);
}
```

**Files to Modify:**
- `src/stdlib/stdlib_async.c` - Promise utilities
- `src/core/interpreter.c` - Promise type support

---

## ğŸ¨ Bonus Features (If Time Permits)

### 4. ğŸ“Š Better Error Messages
- Stack traces showing function call chain
- Colored error output (already have colors!)
- Suggestions for common mistakes
- Line highlighting with context

### 5. ğŸ”§ REPL Improvements
- Multi-line input support
- `.load <file>` command to load scripts
- `.save <file>` to save session
- Tab completion for variables

### 6. ğŸ“¦ Standard Library Additions
- `datetime` module (basic time/date functions)
- `regex` module (regular expressions)
- `crypto` module (SHA256, MD5 hashing)
- `env` module (environment variables)

---

## ğŸ“‹ Implementation Checklist

### Phase 1: Database (Days 1-3)
- [ ] Add SQLite3 to build system
- [ ] Implement `db.open(path)`
- [ ] Implement `db.query(sql, params)`
- [ ] Implement `db.execute(sql, params)`
- [ ] Add transaction support (begin/commit/rollback)
- [ ] Create example: To-do list app with SQLite
- [ ] Write DATABASE.md documentation
- [ ] Test all database operations

### Phase 2: Testing (Days 4-7)
- [ ] Add `TEST` token to lexer
- [ ] Implement test block parsing
- [ ] Create test registry in interpreter
- [ ] Implement assertion functions
- [ ] Build test runner CLI tool
- [ ] Add colored test output
- [ ] Create comprehensive test examples
- [ ] Write TESTING.md documentation

### Phase 3: Async Enhancement (Days 8-9)
- [ ] Implement Promise type in interpreter
- [ ] Add `Promise.all()` function
- [ ] Add `Promise.race()` function
- [ ] Add `Promise.timeout()` helper
- [ ] Test parallel async operations
- [ ] Create async examples
- [ ] Update ASYNC.md documentation

### Phase 4: Polish & Release (Days 10-14)
- [ ] Update version to v0.0.3 everywhere
- [ ] Write CHANGELOG entry
- [ ] Create migration guide from v0.0.2
- [ ] Build example applications:
  - Blog with SQLite backend
  - API server with database
  - CLI tool with tests
- [ ] Performance testing
- [ ] Memory leak checking
- [ ] Documentation review
- [ ] Release announcement

---

## ğŸ¯ Success Criteria

**Technical:**
- âœ… SQLite queries execute correctly
- âœ… Tests can assert and fail properly
- âœ… Promise.all() runs operations in parallel
- âœ… No memory leaks in database operations
- âœ… All examples run without errors

**Quality:**
- âœ… Test coverage for all new features
- âœ… Documentation complete and clear
- âœ… Error messages are helpful
- âœ… Performance is acceptable (<10ms for simple queries)

**User Experience:**
- âœ… Database API feels natural
- âœ… Writing tests is easy and fast
- âœ… Async code is readable
- âœ… Examples are instructive

---

## ğŸš€ Example Application: Task Manager

To demonstrate v0.0.3, we'll build a complete task manager:

```rads
// tasks.rads - Task Manager with Database and Tests

// Setup database
turbo db = db.open("tasks.db");
db.execute("CREATE TABLE IF NOT EXISTS tasks (
    id INTEGER PRIMARY KEY,
    title TEXT NOT NULL,
    done INTEGER DEFAULT 0
)");

// Add task
blast add_task(title) {
    db.execute("INSERT INTO tasks (title) VALUES (?)", [title]);
    echo("âœ… Added: " + title);
}

// List tasks
blast list_tasks() {
    turbo tasks = db.query("SELECT * FROM tasks");
    echo("\nğŸ“‹ Tasks:");
    cruise task in tasks {
        turbo status = task.done ? "âœ“" : " ";
        echo("  [" + status + "] " + task.id + ". " + task.title);
    }
}

// Mark done
blast mark_done(id) {
    db.execute("UPDATE tasks SET done = 1 WHERE id = ?", [id]);
    echo("âœ… Marked task " + id + " as done!");
}

// Tests
test "can add task" {
    turbo db = db.open(":memory:");
    db.execute("CREATE TABLE tasks (id INTEGER PRIMARY KEY, title TEXT, done INTEGER DEFAULT 0)");
    db.execute("INSERT INTO tasks (title) VALUES (?)", ["Test Task"]);

    turbo tasks = db.query("SELECT * FROM tasks");
    assert_eq(tasks.length, 1);
    assert_eq(tasks[0].title, "Test Task");

    db.close();
}

test "can mark task done" {
    turbo db = db.open(":memory:");
    db.execute("CREATE TABLE tasks (id INTEGER, title TEXT, done INTEGER DEFAULT 0)");
    db.execute("INSERT INTO tasks (id, title) VALUES (1, 'Test')");
    db.execute("UPDATE tasks SET done = 1 WHERE id = 1");

    turbo tasks = db.query("SELECT * FROM tasks WHERE id = 1");
    assert_eq(tasks[0].done, 1);

    db.close();
}

// Run app
add_task("Write RADS code");
add_task("Test the code");
add_task("Ship it!");
list_tasks();
mark_done(1);
list_tasks();

db.close();
```

**Run it:**
```bash
# Run the app
$ rads tasks.rads
âœ… Added: Write RADS code
âœ… Added: Test the code
âœ… Added: Ship it!

ğŸ“‹ Tasks:
  [ ] 1. Write RADS code
  [ ] 2. Test the code
  [ ] 3. Ship it!
âœ… Marked task 1 as done!

ğŸ“‹ Tasks:
  [âœ“] 1. Write RADS code
  [ ] 2. Test the code
  [ ] 3. Ship it!

# Run the tests
$ rads test tasks.rads
ğŸ§ª Running tests from tasks.rads

âœ… can add task (1.2ms)
âœ… can mark task done (0.8ms)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Results: 2 passed, 0 failed, 2 total
Time: 2.0ms
ğŸš€ All tests passed!
```

---

## ğŸ“Š Expected Timeline

| Phase | Days | Deliverable |
|-------|------|-------------|
| Database Integration | 1-3 | SQLite driver working |
| Testing Framework | 4-7 | Tests can run and assert |
| Async Enhancement | 8-9 | Promise.all() working |
| Polish & Examples | 10-14 | Release ready |

**Total: 10-14 days** (1-2 weeks)

---

## ğŸ‰ Release Announcement Preview

```
ğŸ¦‹ RADS v0.0.3 "Butterfly" - Released!

After successfully launching v0.0.2 with its stunning RGB Chroma REPL
and rock-solid core language features, we're thrilled to announce
RADS v0.0.3 "Butterfly" - a metamorphosis into production readiness!

What's New:

ğŸ’¾ SQLite Database Driver
  Build real apps with persistent storage! Full SQL support with an
  elegant, safe API. Transactions, prepared statements, and more.

ğŸ§ª Built-in Testing Framework
  Write tests as easily as you write code. The `test` keyword and
  rich assertions make quality a breeze.

âš¡ Enhanced Async
  Promise.all() and Promise.race() bring JavaScript-style parallel
  async operations to RADS.

Keep it TURBO, keep it RADICAL! ğŸš€

Download: github.com/yourusername/rads/releases/v0.0.3
```

---

## ğŸ¯ Beyond v0.0.3: v0.0.4 Preview

After Butterfly stabilizes, v0.0.4 will focus on:
- PostgreSQL driver (production databases)
- Bytecode VM (5-10x performance)
- VS Code extension (syntax highlighting, IntelliSense)
- HTTP/2 server support

---

**Let's make RADS a production language! ğŸ¦‹âœ¨**

*Stay TURBO. Stay RADICAL.*

â€” RADS Core Team
