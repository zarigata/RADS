# üöÄ RADS v0.0.7 Development Plan

**Codename:** DARK MOON
**Theme:** Dark Eclipsed Velocity, Lunar Ascent, Midnight Code
**Target Release:** March 2026 (estimated)
**Status:** Planning Phase  

---

## üéØ Vision

v0.0.7 will represent the **lunar eclipse** in RADS performance and developer experience. Building on the "FIGHTER JET" foundation (v0.0.6), this release focuses on:
- **Extreme Performance** through JIT compilation
- **Professional Tooling** with advanced LSP and debugging
- **Language Expansion** with ECMAScript transpiler
- **Production Readiness** with robust standard library

---

## üìã Numbered Feature List (Critical Updates)

### üî• PRIORITY 1 - Performance Critical

**1. LLVM JIT Compilation Engine** ‚≠ê‚≠ê‚≠ê
- **Goal:** 10-50x speedup on hot code paths
- **Implementation:**
  - Integrate LLVM as JIT backend
  - Profile-guided optimization (PGO)
  - Hot path detection and compilation
  - Fallback to bytecode interpreter for cold paths
  - Dynamic recompilation for adaptive performance
- **Files:**
  - `src/jit/llvm_backend.c` - LLVM wrapper
  - `src/jit/jit_compiler.c` - JIT compiler
  - `src/jit/code_cache.c` - Compiled code cache
  - Update `src/vm/vm.c` to call JIT when available
- **Dependencies:**
  - LLVM 15+ libraries
  - CMake build system for LLVM integration
- **Testing:**
  - Benchmarks showing 10-50x speedup
  - Memory overhead <20%
  - Safe fallback to interpreter
- **Success Criteria:**
  - ‚úÖ JIT compiles frequently called functions
  - ‚úÖ Performance benchmarks show 10x+ improvement
  - ‚úÖ No stability regressions
  - ‚úÖ Clean integration with existing VM

**2. Advanced Garbage Collection** ‚≠ê‚≠ê
- **Goal:** Reduce memory overhead and prevent leaks
- **Implementation:**
  - Generational GC (young/old generation)
  - Incremental collection pauses
  - Write barrier implementation
  - GC statistics and tuning options
- **Files:**
  - `src/gc/generational.c` - Generational GC
  - `src/gc/write_barrier.c` - Write barriers
  - Update `src/gc/gc.c` to use new collector
- **Success Criteria:**
  - ‚úÖ <5ms GC pause time
  - ‚úÖ 30% reduction in memory usage
  - ‚úÖ No memory leaks in benchmarks

---

### üõ†Ô∏è PRIORITY 2 - Developer Experience

**3. Advanced LSP with Code Actions** ‚≠ê‚≠ê
- **Goal:** Professional VS Code/IDE experience
- **Implementation:**
  - **Refactoring Support:**
    - Rename symbol (local, global, file)
    - Extract function/method
    - Inline variable
    - Extract to constant
  - **Code Actions:**
    - Quick fix suggestions
    - Import organization
    - Sort imports
    - Auto-fix for common errors
  - **Enhanced Diagnostics:**
    - Real-time type checking
    - Code suggestions
    - Unused variable detection
    - Dead code highlighting
  - **Better Navigation:**
    - Find references
    - Go to implementation
    - Symbol search across project
- **Files:**
  - `tools/rads-lsp/src/refactor.rs` - Refactoring logic
  - `tools/rads-lsp/src/code_actions.rs` - Code actions
  - `tools/rads-lsp/src/diagnostics.rs` - Enhanced diagnostics
  - Update `tools/rads-lsp/src/main.rs` with new capabilities
- **Success Criteria:**
  - ‚úÖ 10+ refactor/code actions implemented
  - ‚úÖ VS Code extension supports all features
  - ‚úÖ Zero false positives in diagnostics
  - ‚úÖ Sub-second response times

**4. Enhanced Debug Protocol** ‚≠ê‚≠ê
- **Goal:** Full-featured debugging experience
- **Implementation:**
  - **Conditional Breakpoints:**
    - Break when expression evaluates to true
    - Break count limit
    - Ignore count (hit N times before breaking)
  - **Watch Expressions:**
    - Watch variables and expressions
    - Automatic refresh on step
    - Watch window in IDE
  - **Advanced Stepping:**
    - Step into (follow function calls)
    - Step over (stay in current function)
    - Step out (finish current function)
  - **Call Stack Inspection:**
    - Full stack trace
    - Navigate up/down stack frames
    - View locals in any frame
  - **Exception Handling:**
    - Break on uncaught errors
    - Exception type information
- **Files:**
  - `src/debug/conditional_breakpoints.c` - Conditional breakpoints
  - `src/debug/watch_expressions.c` - Watch expressions
  - `src/debug/call_stack.c` - Call stack inspection
  - Update `src/debug/debug_protocol.c` with new commands
- **Success Criteria:**
  - ‚úÖ Conditional breakpoints work
  - ‚úÖ Watch expressions update in real-time
  - ‚úÖ Full call stack visible
  - ‚úÖ VS Code debugger integration complete

---

### üåê PRIORITY 3 - Language Features

**5. ECMAScript Transpiler (JavaScript ‚Üí RADS)** ‚≠ê
- **Goal:** Support JavaScript developers
- **Implementation:**
  - Parse JavaScript (ES2022+ subset)
  - Convert to RADS AST
  - Generate RADS code
  - Handle:
    - Variables and scoping
    - Functions and closures
    - Objects and arrays
    - Async/await
    - Classes (map to structs)
    - Arrow functions
    - Template literals
    - Destructuring
- **Files:**
  - `tools/rads-js/src/js_parser.c` - JS parser
  - `tools/rads-js/src/ast_converter.c` - JS ‚Üí RADS AST converter
  - `tools/rads-js/src/code_gen.c` - RADS code generator
  - `tools/rads-js/Makefile` - Build system
  - `tools/rads-js/README.md` - Documentation
- **Dependencies:**
  - Reuse `tools/rads-mask/src/ast.h` (shared AST)
- **Success Criteria:**
  - ‚úÖ 90%+ accuracy on test corpus
  - ‚úÖ Handle 80%+ of common JS patterns
  - ‚úÖ Generate clean, readable RADS code

**6. Type System Enhancements** ‚≠ê
- **Goal:** Better type safety and expressiveness
- **Implementation:**
  - Optional type annotations (`x: turbo`, `name: string`)
  - Generic types (`List<T>`, `Option<T>`)
  - Union types (`string | number`)
  - Improved type inference
  - Type checking phase
  - Type errors with suggestions
- **Files:**
  - `src/typecheck/optional_types.c` - Optional types
  - `src/typecheck/generics.c` - Generics
  - `src/typecheck/inference.c` - Type inference
  - Update `src/parser/` to parse type annotations
- **Success Criteria:**
  - ‚úÖ Type annotations parse correctly
  - ‚úÖ Type checker catches common errors
  - ‚úÖ Performance impact <10%
  - ‚úÖ Backward compatible (types optional)

---

### üìö PRIORITY 4 - Standard Library

**7. Comprehensive stdlib Expansion** ‚≠ê‚≠ê
- **Goal:** Rich standard library
- **Implementation:**
  - **String Operations:**
    - `string.split()`, `string.join()`
    - `string.trim()`, `string.upper()`, `string.lower()`
    - `string.replace()`, `string.substring()`
  - **Array Operations:**
    - `array.map()`, `array.filter()`, `array.reduce()`
    - `array.find()`, `array.some()`, `array.every()`
    - `array.sort()`, `array.reverse()`
  - **Math Functions:**
    - `math.min()`, `math.max()`, `math.clamp()`
    - `math.floor()`, `math.ceil()`, `math.round()`
    - `math.random()` (seeded)
  - **Filesystem:**
    - `fs.readdir()`, `fs.stat()`, `fs.unlink()`
    - Path manipulation utilities
  - **Async Utilities:**
    - `async.parallel()`, `async.series()`
    - `async.retry()`, `async.timeout()`
- **Files:**
  - `src/stdlib/stdlib_string_advanced.c` - Advanced string functions
  - `src/stdlib/stdlib_array.c` - Array operations
  - `src/stdlib/stdlib_math_extended.c` - Extended math
  - `src/stdlib/stdlib_filesystem.c` - Filesystem operations
  - `src/stdlib/stdlib_async_utils.c` - Async utilities
- **Success Criteria:**
  - ‚úÖ 50+ new stdlib functions
  - ‚úÖ All functions documented
  - ‚úÖ Unit tests for all functions
  - ‚úÖ Performance benchmarks

---

### üß™ PRIORITY 5 - Testing & Quality

**8. Testing Framework Improvements** ‚≠ê‚≠ê
- **Goal:** Professional testing experience
- **Implementation:**
  - **Test Discovery:**
    - Auto-discover test files
    - Pattern matching for test files (`*_test.rads`)
  - **Test Filtering:**
    - Run specific tests (`rads test --pattern "db*"`)
    - Exclude tests (`rads test --exclude "slow*"`)
    - Tags/labels (`@slow`, `@integration`)
  - **Parallel Execution:**
    - Run tests in parallel
    - Worker pool management
  - **Test Output:**
    - JUnit XML format
    - JSON output for CI integration
    - Coverage reports
  - **Mocking:**
    - Mock stdlib functions
    - Spy on function calls
- **Files:**
  - `src/test/test_discovery.c` - Test discovery
  - `src/test/test_runner_parallel.c` - Parallel runner
  - `src/test/test_output.c` - Output formatting
  - `src/test/mocking.c` - Mocking framework
  - Update `src/test/test.c` with new features
- **Success Criteria:**
  - ‚úÖ Tests run 2-5x faster (parallel)
  - ‚úÖ JUnit XML output works
  - ‚úÖ CI/CD integration tested

**9. Error Handling Improvements** ‚≠ê
- **Goal:** Better error messages and handling
- **Implementation:**
  - **Custom Error Types:**
    - Define error categories (IO, Network, Database, etc.)
    - Error codes and messages
    - Stack traces
  - **Try-Catch Blocks:**
    - Syntax: `try { ... } catch (e) { ... }`
    - Catch specific error types
    - Finally blocks
  - **Error Suggestions:**
    - Suggest fixes based on error
    - Show similar functions
    - Link to documentation
  - **Error Recovery:**
    - Automatic retry for transient errors
    - Circuit breaker pattern
- **Files:**
  - `src/runtime/error_types.c` - Error type system
  - `src/parser/try_catch.c` - Try-catch parsing
  - Update `src/runtime/runtime.c` to handle errors
- **Success Criteria:**
  - ‚úÖ Try-catch works correctly
  - ‚úÖ Error messages are helpful
  - ‚úÖ Error recovery functions work

---

### üìñ PRIORITY 6 - Documentation

**10. Complete API Documentation** ‚≠ê‚≠ê
- **Goal:** Comprehensive documentation
- **Implementation:**
  - **Auto-Generated Docs:**
    - Extract function signatures
    - Generate Markdown/HTML
    - Include examples
  - **Documentation Format:**
    - Function descriptions
    - Parameters with types
    - Return values
    - Examples for each function
    - Cross-references
  - **Inline Help:**
    - `rads --help function_name`
    - `rstar docs <package>`
- **Files:**
  - `tools/docs_gen/doc_extractor.c` - Doc extractor
  - `tools/docs_gen/generator.c` - Doc generator
  - `docs/API_REFERENCE.md` - Complete API reference
  - Update all stdlib files with doc comments
- **Success Criteria:**
  - ‚úÖ All stdlib functions documented
  - ‚úÖ HTML documentation generated
  - ‚úÖ Inline help works
  - ‚úÖ Docs pass linter

---

### üèóÔ∏è PRIORITY 7 - Build & Tooling

**11. Build System Improvements** ‚≠ê
- **Goal:** Faster and more reliable builds
- **Implementation:**
  - **Incremental Builds:**
    - Only rebuild changed files
    - Dependency tracking
  - **Faster Compilation:**
    - Parallel compilation
    - CCACHE integration
  - **Better Error Messages:**
    - Show what file/line caused error
    - Suggest fixes
  - **Build Targets:**
    - `make debug` - Debug build with symbols
    - `make release` - Optimized release build
    - `make test` - Build and run tests
    - `make clean` - Clean all artifacts
- **Files:**
  - `Makefile` - Updated with new targets
  - `build/dep_tracker.c` - Dependency tracking
  - `build/incremental.c` - Incremental build
- **Success Criteria:**
  - ‚úÖ Builds are 2-3x faster
  - ‚úÖ Incremental builds work
  - ‚úÖ Error messages are clear

**12. Package Manager Integration** ‚≠ê
- **Goal:** Full rstar CLI functionality
- **Implementation:**
  - **Package Commands:**
    - `rstar search <query>` - Search packages
    - `rstar install <package>` - Install package
    - `rstar update` - Update packages
    - `rstar publish` - Publish package
    - `rstar list` - List installed
  - **Registry Integration:**
    - Connect to registry.rads-lang.org
    - Download and verify packages
    - Install to `~/.rads/packages/`
  - **Package Structure:**
    - `package.rads` - Metadata
    - `src/` - Source code
    - `README.md` - Documentation
- **Files:**
  - `rstar/rstar.c` - CLI implementation
  - `rstar/registry.c` - Registry client
  - `rstar/package_manager.c` - Package operations
- **Success Criteria:**
  - ‚úÖ Can search and install packages
  - ‚úÖ Packages install correctly
  - ‚úÖ Registry integration works

---

### üîÆ PRIORITY 8 - Future Foundation

**13. WebAssembly Support (Experimental)** ‚≠ê
- **Goal:** RADS can run in browsers
- **Implementation:**
  - Compile RADS to WebAssembly
  - WASI (WebAssembly System Interface) bindings
  - Browser stdlib (DOM, fetch, etc.)
  - WASM runtime integration
- **Files:**
  - `src/wasm/wasm_compiler.c` - WASM backend
  - `src/wasm/wasi_bindings.c` - WASI bindings
  - `src/wasm/browser_api.c` - Browser APIs
- **Success Criteria:**
  - ‚úÖ Simple RADS programs run in browser
  - ‚úÖ Basic stdlib functions work
  - ‚úÖ Demo application works

---

## üìä Feature Priority Matrix

| Priority | Feature | Impact | Complexity | Est. Effort | Timeline |
|----------|----------|---------|------------|-----------|
| 1 | JIT Compilation | ‚≠ê‚≠ê‚≠ê HIGH | HIGH | 60-80 hrs | Week 1-2 |
| 2 | Advanced GC | ‚≠ê‚≠ê‚≠ê HIGH | MEDIUM | 40-60 hrs | Week 2 |
| 3 | Advanced LSP | ‚≠ê‚≠ê HIGH | MEDIUM | 50-70 hrs | Week 2-3 |
| 4 | Enhanced Debugger | ‚≠ê‚≠ê HIGH | MEDIUM | 40-60 hrs | Week 3 |
| 5 | ECMAScript Transpiler | ‚≠ê‚≠ê MEDIUM | HIGH | 80-100 hrs | Week 3-4 |
| 6 | Type System | ‚≠ê‚≠ê MEDIUM | HIGH | 50-70 hrs | Week 4 |
| 7 | stdlib Expansion | ‚≠ê‚≠ê HIGH | LOW | 30-50 hrs | Week 4 |
| 8 | Testing Framework | ‚≠ê‚≠ê HIGH | MEDIUM | 40-60 hrs | Week 4 |
| 9 | Error Handling | ‚≠ê‚≠ê HIGH | MEDIUM | 30-50 hrs | Week 5 |
| 10 | API Documentation | ‚≠ê‚≠ê MEDIUM | LOW | 20-40 hrs | Week 5 |
| 11 | Build System | ‚≠ê‚≠ê LOW | MEDIUM | 20-40 hrs | Week 5 |
| 12 | Package Manager | ‚≠ê‚≠ê MEDIUM | MEDIUM | 40-60 hrs | Week 5-6 |
| 13 | WebAssembly | ‚≠ê LOW | HIGH | 60-80 hrs | Week 6-8 |

---

## üóìÔ∏è Development Timeline (6 Weeks)

### Week 1: JIT Foundation
- **Focus:** Features #1 (JIT)
- **Tasks:**
  - LLVM integration setup
  - Basic JIT compiler
  - Hot path detection
  - Initial benchmarks
- **Deliverables:**
  - JIT compiles simple functions
  - 5-10x speedup on benchmarks

### Week 2: LSP & Debugger
- **Focus:** Features #3, #4
- **Tasks:**
  - Code actions implementation
  - Refactoring support
  - Conditional breakpoints
  - Watch expressions
- **Deliverables:**
  - VS Code supports refactoring
  - Debugger has advanced features

### Week 3: Transpiler & Types
- **Focus:** Features #5, #6
- **Tasks:**
  - ECMAScript parser
  - JS ‚Üí RADS converter
  - Optional type annotations
  - Type inference
- **Deliverables:**
  - Basic JS transpiler works
  - Type annotations parse

### Week 4: stdlib & Testing
- **Focus:** Features #7, #8
- **Tasks:**
  - Implement 50+ stdlib functions
  - Parallel test runner
  - Test discovery
  - Mocking framework
- **Deliverables:**
  - Rich stdlib available
  - Tests run 3x faster

### Week 5: Quality & Docs
- **Focus:** Features #9, #10
- **Tasks:**
  - Try-catch implementation
  - Error handling improvements
  - API documentation generation
  - Inline help system
- **Deliverables:**
  - Error messages improved
  - Complete API docs

### Week 6: Tooling & Polish
- **Focus:** Features #11, #12, #13 (if time)
- **Tasks:**
  - Build system improvements
  - Package manager integration
  - Final testing and polish
  - WebAssembly (stretch goal)
- **Deliverables:**
  - Fast incremental builds
  - rstar CLI functional
  - Release-ready code

---

## ‚ö†Ô∏è Critical Updates Required

### Before Starting Development
- [ ] **LLVM Environment Setup**
  - Install LLVM 15+ development libraries
  - Verify cmake can build LLVM
  - Test basic LLVM integration
- [ ] **Dependencies Update**
  - Update CMakeLists.txt or Makefile for LLVM
  - Add new dependencies to build system
  - Document LLVM installation requirements
- [ ] **Architecture Review**
  - Review VM architecture for JIT integration
  - Identify hot code paths
  - Plan code cache strategy
- [ ] **Testing Framework**
  - Set up benchmark suite
  - Create performance regression tests
  - Establish performance baseline

### During Development
- [ ] **Weekly Benchmarks**
  - Track JIT compilation speed
  - Measure performance improvements
  - Compare to v0.0.6 baseline
- [ ] **Code Quality**
  - Maintain >80% test coverage
  - Linting for all new code
  - Code reviews for complex changes
- [ ] **Documentation**
  - Document new features as implemented
  - Keep README up to date
  - Update CHANGELOG weekly

---

## üéØ Success Criteria

### Must Have for Release
- ‚úÖ JIT compilation achieves 10-50x speedup on hot paths
- ‚úÖ Advanced LSP with at least 10 code actions
- ‚úÖ Enhanced debugger with conditional breakpoints
- ‚úÖ ECMAScript transpiler handles 80%+ of common patterns
- ‚úÖ 50+ new stdlib functions implemented
- ‚úÖ All features tested and documented
- ‚úÖ No critical bugs remaining
- ‚úÖ Performance benchmarks show improvement

### Nice to Have
- ‚≠ê WebAssembly MVP works
- ‚≠ê Package manager fully functional
- ‚≠ê 100% type inference for common cases
- ‚≠ê 20+ refactor/code actions
- ‚≠ê JUnit XML output for CI

---

## üìù Notes

### Design Decisions
1. **JIT Approach:** Use LLVM for mature, well-tested JIT backend
2. **LSP Priority:** Focus on code actions over advanced features (completion already good)
3. **Transpiler:** Start with ES2022 subset, expand in future versions
4. **Type System:** Optional types to maintain backward compatibility
5. **stdlib:** Prioritize most-used functions (strings, arrays, async)

### Risks & Mitigations
1. **JIT Complexity:** High risk. Mitigation: Start with simple functions, test thoroughly
2. **LSP Scope:** Too many features. Mitigation: Implement top 10 actions first
3. **Transpiler Accuracy:** May not be perfect. Mitigation: Clearly document limitations
4. **Performance Regression:** JIT may have overhead. Mitigation: Profile extensively, fallback to interpreter
5. **Timeline Pressure:** 6 weeks is aggressive. Mitigation: Cut WebAssembly if needed, prioritize P1 features

### Alternatives Considered
1. **JIT Backend:** LLVM vs. Cranelift. Chose LLVM for maturity and ecosystem
2. **LSP Implementation:** Extend Rust LSP vs. Rewrite. Chose extend for speed
3. **Transpiler Language:** JavaScript vs. TypeScript vs. Python. Chose JS for largest user base
4. **Build System:** CMake vs. Meson vs. Make. Chose enhanced Make for compatibility

---

## üîó Related Documents

- [V0.0.6_FIGHTER_JET_SUMMARY.md](./V0.0.6_FIGHTER_JET_SUMMARY.md) - Previous release
- [CHANGELOG.md](./CHANGELOG.md) - Version history
- [VERSION_TRACKING.md](./.local/VERSION_TRACKING.md) - Version management
- [RELEASE_CHECKLIST.md](./.local/RELEASE_CHECKLIST.md) - Release process

---

## üìû Questions & Decisions Needed

1. **JIT Scope:** Should v0.0.7 include full JIT or MVP? (Recommend: MVP with top functions)
2. **LSP Features:** Prioritize refactoring or advanced diagnostics? (Recommend: Refactoring first)
3. **Type Safety:** How strict? (Recommend: Optional types, gradual adoption)
4. **Transpiler Accuracy:** 80% or 90% target? (Recommend: 90% for common patterns, 80% overall)
5. **Release Timeline:** Is March realistic? (Recommend: 6-8 weeks needed, target April)
6. **WebAssembly:** Include in v0.0.7 or defer to v0.0.8? (Recommend: Defer, focus on core features)

---

**Created:** January 27, 2026  
**Last Updated:** January 27, 2026  
**Status:** Awaiting Review & Approval  
**Next Step:** Get answers to questions above, begin Week 1 development

---

*"From FIGHTER JET to DARK MOON - The lunar eclipse continues!"* üåë
